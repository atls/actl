import { extname } from "path";
import esbuild from "esbuild";

type MainBuildPartProps = {
  allFiles: Array<string>;
  outDir: string;
};

export const esbuildBuildStep = async ({
  allFiles,
  outDir,
}: MainBuildPartProps): Promise<void> => {
  const tsJsFiles = allFiles.filter((file) =>
    [".ts", ".js"].includes(extname(file))
  );

  await esbuild.build({
    logLevel: "error",
    // entryPoints: tsJsFiles,
    entryPoints: ["src/schematic/index.ts"],
    // outdir: outDir,
    bundle: true,
    // external: ["@atls/code-runtime"],
    packages: "external",
    outfile: "dist/schematic.cjs",
    outbase: "src/schematic",
    format: "cjs",
    platform: "node",
    sourcemap: false,
    target: "esnext",
  });
};
