/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-badges",
factory: function (require) {
"use strict";var plugin=(()=>{var w=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var n=(i=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(i,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):i)(function(i){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+i+'" is not supported')});var q=(i,t)=>{for(var r in t)w(i,r,{get:t[r],enumerable:!0})},z=(i,t,r,g)=>{if(t&&typeof t=="object"||typeof t=="function")for(let f of M(t))!K.call(i,f)&&f!==r&&w(i,f,{get:()=>t[f],enumerable:!(g=F(t,f))||g.enumerable});return i};var J=i=>z(w({},"__esModule",{value:!0}),i);var Q={};q(Q,{BadgesCommand:()=>l,default:()=>I});var j=n("@yarnpkg/cli"),P=n("@yarnpkg/cli"),O=n("@yarnpkg/core"),T=n("@yarnpkg/core"),G=n("@yarnpkg/core"),d=n("@yarnpkg/core"),C=n("@yarnpkg/core"),D=n("fs"),$=n("fs"),A=n("path");var L=n("@yarnpkg/core"),S=n("@yarnpkg/core"),h=class{constructor(t,r){this.stdout=t;this.configuration=r;this.running=!1;this.position=0}start(){this.stdout.isTTY&&(this.running=!0,this.write(),this.tick())}end(){this.stdout.isTTY&&this.running&&(this.running=!1,this.clear(!0))}tick(){setTimeout(()=>{this.running&&(this.clear(),this.write(),this.position=this.position>=h.length?0:this.position+1,this.tick())},h.PROGRESS_INTERVAL)}write(){let t=h.PROGRESS_FRAMES[this.position],r=S.formatUtils.pretty(this.configuration,`YN${L.MessageName.UNNAMED.toString(10).padStart(4,"0")}`,"gray");this.stdout.write(`${S.formatUtils.pretty(this.configuration,"\u27A4","blueBright")} ${r}: \u2502 ${t}
`)}clear(t=!1){this.stdout.write(`\x1B[${0}A`),t&&this.stdout.write("\x1B[0J")}},m=h;m.PROGRESS_FRAMES=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],m.PROGRESS_INTERVAL=120;var b=["@atls/code-service","@atls/schematics","@atls/next-identity-integration","@atls/react-kratos-browser-flows","@atls/nestjs-dataloader","@atls/nestjs-external-renderer","@atls/nestjs-gateway","@atls/nestjs-grpc-errors","@atls/nestjs-grpc-http-proxy","@atls/nestjs-grpc-identity","@atls/nestjs-grpc-playground","@atls/nestjs-grpc-reflection","@atls/nestjs-hydra","@atls/nestjs-keto","@atls/nestjs-kratos","@atls/nestjs-typesense-typeorm","@atls/nestjs-typesense","@atls-ui-generators/button","@atls-ui-generators/input","@atls-ui-generators/icons"],y={"@atls/nestjs":{labelColor:"#CB5458",color:"#BE4045"},"@atls/next":{labelColor:"#354247",color:"#1D282D"},"@atls/react":{labelColor:"#43CFF4",color:"#2DBFE6"},"@atls-ui":{labelColor:"#097CEB",color:"#0B6DCC"},tools:{labelColor:"#ECEEF5",color:"#D7DCEB"}};var u=class extends j.BaseCommand{async execute(){let t=await T.Configuration.find(this.context.cwd,this.context.plugins),{project:r,workspace:g}=await G.Project.find(t,this.context.cwd);if(!g)throw new P.WorkspaceRequiredError(r.cwd,this.context.cwd);return await r.restoreInstallState(),(await O.StreamReport.start({stdout:this.context.stdout,configuration:t},async B=>{await B.startTimerPromise("Generating badges",async()=>{let x=new m(this.context.stdout,t);x.start();let H=e=>{let s=e.anchoredLocator.locatorHash,c=new Map,a=[s];for(;a.length>0;){let p=a.shift();if(c.has(p))continue;let o=r.storedPackages.get(p);if(typeof o>"u")throw new Error("Assertion failed: Expected the package to be registered");if(c.set(p,o),d.structUtils.isVirtualLocator(o)&&a.push(d.structUtils.devirtualizeLocator(o).locatorHash),p===s)for(let v of o.dependencies.values()){let R=r.storedResolutions.get(v.descriptorHash);if(typeof R>"u")throw new Error("Assertion failed: Expected the resolution to be registered");a.push(R)}}return c.values()},Y=(()=>{let e=new Map;for(let s of r.workspaces)for(let c of H(s))e.set(c.locatorHash,c);return e.values()})(),N=C.miscUtils.sortMap([...Y],e=>d.structUtils.stringifyLocator(e)),U=async e=>{let s=d.structUtils.parseDescriptor(e),c=N.filter(a=>a.scope===s.scope&&a.name===s.name);return c.length>0?c.shift().version:""},k=(0,A.join)(process.cwd(),"README.md"),E=(0,D.readFileSync)(k).toString("utf-8").split(u.VERSIONS_SEPARATOR),V=await Promise.all(b.map(async e=>({name:e,version:await U(e)}))),W=(e,s)=>{let c=()=>{let a=o=>({labelColor:o.labelColor.replace("#",""),color:o.color.replace("#","")}),p=Object.entries(y).find(([o])=>s.name.search(o)!==-1);if(p){let[,o]=p;return a(o)}return a(y.tools)};if(s.version){let a=`${u.REGISTRY_URL}${u.REGISTRY_PACKAGE_PATH}/${s.name}`;(0,A.join)(u.REGISTRY_URL,u.REGISTRY_PACKAGE_PATH,s.name);let p=new URLSearchParams({style:u.BADGE_STYLE,label:s.name,message:s.version,...c()}),o=`<img src="${u.BADGE_URL}?${p.toString()}" alt='badge'>`;return`${e}${((R,_)=>`[${R}](${_})`)(o,a)}  `}return e};E[1]=V.reduce(W,""),E[1]=`

${E[1]}

`,(0,$.writeFileSync)(k,E.join("[//]: # (VERSIONS)")),x.end()})})).exitCode()}},l=u;l.paths=[["badges","generate"]],l.VERSIONS_SEPARATOR="[//]: # (VERSIONS)",l.BADGE_URL="https://img.shields.io/static/v1",l.BADGE_STYLE="for-the-badge",l.REGISTRY_URL="https://npmjs.com",l.REGISTRY_PACKAGE_PATH="/package";var I={commands:[l]};return J(Q);})();
return plugin;
}
};
