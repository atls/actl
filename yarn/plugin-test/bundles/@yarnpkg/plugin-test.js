/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-test",
factory: function (require) {
var plugin=(()=>{var N=Object.create,w=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var B=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var H=e=>w(e,"__esModule",{value:!0});var s=e=>{if(typeof require!="undefined")return require(e);throw new Error('Dynamic require of "'+e+'" is not supported')};var J=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Q=(e,t)=>{for(var r in t)w(e,r,{get:t[r],enumerable:!0})},U=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of j(t))!E.call(e,o)&&o!=="default"&&w(e,o,{get:()=>t[o],enumerable:!(r=T(t,o))||r.enumerable});return e},i=e=>U(H(w(e!=null?N(B(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var A=J((M,b)=>{var y;b.exports.getContent=()=>(typeof y=="undefined"&&(y=s("zlib").brotliDecompressSync(Buffer.from("G54NAIzDdKtxyzNwShnmv8vVvZfTm1VIWDMIK2qEtr/jNAE64w2iYNb3bNn8C09xGiNRCqbt3bfW7BZa1ygQlng81hG0qY/lushXKiCDgbrIkymTB6HyoIkukzdtRydAo/GSbBHkAAlGZeIDe24siHDB3lDQvjx6oDELKH/YopjAivEiRfnXLxt638ZOwFdwCROQsDUcGpNT0SUsrSHJ8LLqZLipiAJdqlN86LsnD42iThQtRwYR3J2GDcZJTZNRQdjpgWW+8SqcuaqLJxolqCR5tV5SDURTc+JE46y8joU2DecUltT7QQ00HaIf4UAIJnhtDKLO7ouFe7UKf9H3zRiGyQwx5ZAJrP60afgHHaOYJMtB4w+GS8sKKWOpcbJhowEWJk2ymGIyAUuvnxtPOU8AaBZgkoUt35FKBR7DXQtppJmFaQrpz/fuH1eRcysX6bj4ea4sAN1iKefMC3OW+k44nte9A0yTjuB1q/oHlg5WXilE8gkrp79Vepb1c27Qsx+HFaDxDQjCLdkMwyDSv48O3JFCyfphY4ghhpd9Uvtl6DLwiIKxfBIGs8tXRGxHQ1DMA/pY2MLSPANSdJTCC3ugD5fJ9ZZfX8z12curOb16WWbpkXk/ezaLPX30vQmNmVN45opywFpsTLNCfiz4EhOWMrFFoPwSbDwREVpbmFlu05Mr0bkAw6EV8u9hOYYZznEA7CRkDfXpquCx+UrWu9kLfUYiLfW6GALqReqzxNywvt67OIw4xnSvlWU8bXopPY7MZM38WQK/OqdIWbwl2w6xMAQqTbnPCYM5VufBndKaShxmI+WQF4KFOHEhn4WhYjP3JQT6K2E+VbmY5PFwEFoXNkhK8vbMlStROGiQTINykyRROeK1ZjFkonJK7vFFXhVc1kWaixY5yzn1ra4dnJRuZaFqtoShNmOzGA5eXJFmyhHhpaX3E7iUkR0haPZOpNGMYHxXuG4j4+7+wyk0bNUHpoy87Ct3cnvFdF8Vfo7kocTYBf+qMnSzxPI72rvJ9wWYvUXku1u/nabY8UXx/e/jC0yV/PouofokujABFWwLHU5hCI2fv+ROrGeEl4M6pzbaEj565Qz5OhUVh7D4Y8EAYZ5FYFNrzEzUOYMD7JuXCyFRCXFa75VS0YcNPRNhDYuF1xO5pzodbDBKqH5xbVOhRjgpVfg1a2MSYfvK0aAZ2aq8k1NRneZOPQ==","base64")).toString()),y)});var K={};Q(K,{TestIntegrationCommand:()=>l,TestUnitCommand:()=>h,default:()=>Y});var C=i(s("@yarnpkg/cli")),W=i(s("@yarnpkg/core")),S=i(s("@yarnpkg/core")),q=i(s("@yarnpkg/core")),f=i(s("clipanion"));var g=i(s("node:worker_threads")),x=i(s("node:path")),k=class{static async run(t,r){return new Promise((o,a)=>{let p=process.versions.pnp?s("module").findPnpApi(__filename).resolveRequest("pnpapi",null):(0,x.join)(process.cwd(),".pnp.cjs"),n=new g.Worker(t,{eval:!0,execArgv:["--require",p,...process.execArgv],workerData:r}),c=d=>{d!==0&&a(new Error(`Worker stopped with exit code ${d}`))};n.once("message",d=>{n.off("error",a),n.off("exit",c),o(d)}),n.once("error",a),n.once("exit",c)})}static async watch(t,r,o){return new Promise((a,p)=>{let n=process.versions.pnp?s("module").findPnpApi(__filename).resolveRequest("pnpapi",null):(0,x.join)(process.cwd(),".pnp.cjs"),c=new g.Worker(t,{eval:!0,execArgv:["--require",n,...process.execArgv],workerData:r}),d=R=>{R!==0?p(new Error(`Worker stopped with exit code ${R}`)):a(null)};c.on("message",o),c.once("error",p),c.once("exit",d)})}};var v=i(A()),m=class{constructor(t){this.cwd=t}async run(t,r,o){return k.run((0,v.getContent)(),{cwd:this.cwd,type:t,options:r,files:o})}};var l=class extends C.BaseCommand{constructor(){super(...arguments);this.bail=f.Option.Boolean("-b,--bail",!1);this.updateSnapshot=f.Option.Boolean("-u,--update-shapshot",!1);this.findRelatedTests=f.Option.Boolean("--find-related-tests",!1);this.files=f.Option.Rest({required:0})}async execute(){let t=await S.Configuration.find(this.context.cwd,this.context.plugins),{project:r,workspace:o}=await q.Project.find(t,this.context.cwd),a=[];if(o){let n=this.context.cwd.replace(r.cwd,"");a.push(n.startsWith("/")?n.substr(1):n)}return(await W.StreamReport.start({stdout:this.context.stdout,configuration:t},async()=>{await new m(r.cwd).run("integration",{findRelatedTests:this.findRelatedTests,updateSnapshot:this.updateSnapshot,bail:this.bail},a.concat(this.files))})).exitCode()}};l.paths=[["test","integration"]];var D=i(s("@yarnpkg/cli")),F=i(s("@yarnpkg/core")),P=i(s("@yarnpkg/core")),O=i(s("@yarnpkg/core")),u=i(s("clipanion"));var h=class extends D.BaseCommand{constructor(){super(...arguments);this.bail=u.Option.Boolean("-b,--bail",!1);this.updateSnapshot=u.Option.Boolean("-u,--update-shapshot",!1);this.findRelatedTests=u.Option.Boolean("--find-related-tests",!1);this.files=u.Option.Rest({required:0})}async execute(){let t=await P.Configuration.find(this.context.cwd,this.context.plugins),{project:r,workspace:o}=await O.Project.find(t,this.context.cwd),a=[];if(o){let n=this.context.cwd.replace(r.cwd,"");a.push(n.startsWith("/")?n.substr(1):n)}return(await F.StreamReport.start({stdout:this.context.stdout,configuration:t},async()=>{await new m(r.cwd).run("unit",{findRelatedTests:this.findRelatedTests,updateSnapshot:this.updateSnapshot,bail:this.bail},a.concat(this.files))})).exitCode()}};h.paths=[["test","unit"]];var Y={commands:[l,h]};return K;})();
return plugin;
}
};
