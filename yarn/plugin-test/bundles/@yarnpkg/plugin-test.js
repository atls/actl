/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-test",
factory: function (require) {
"use strict";var plugin=(()=>{var x=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var i=(a=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(a,{get:(e,s)=>(typeof require<"u"?require:e)[s]}):a)(function(a){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+a+'" is not supported')});var Y=(a,e)=>{for(var s in e)x(a,s,{get:e[s],enumerable:!0})},N=(a,e,s,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of K(e))!M.call(a,r)&&r!==s&&x(a,r,{get:()=>e[r],enumerable:!(o=D(e,r))||o.enumerable});return a};var F=a=>N(x({},"__esModule",{value:!0}),a);var G={};Y(G,{TestIntegrationCommand:()=>l,TestUnitCommand:()=>h,default:()=>z});var S=i("node:path"),B=i("@yarnpkg/cli"),P=i("@yarnpkg/core"),T=i("@yarnpkg/core"),v=i("@yarnpkg/core"),u=i("clipanion");var k=i("node:fs"),g=i("node:fs"),A=i("node:fs"),m=i("node:path"),b=i("node:path"),y=i("node:worker_threads"),p=class{static build(e,s){let o=(0,m.join)(process.cwd(),".yarn/dist/worker.mjs"),r=[];return(0,g.existsSync)((0,m.join)(process.cwd(),".pnp.cjs"))&&(r.push("--require"),r.push((0,m.join)(process.cwd(),".pnp.cjs"))),(0,g.existsSync)((0,m.join)(process.cwd(),".pnp.loader.mjs"))&&(r.push("--loader"),r.push((0,m.join)(process.cwd(),".pnp.loader.mjs"))),(0,g.existsSync)((0,b.dirname)(o))||(0,A.mkdirSync)((0,b.dirname)(o)),(0,k.writeFileSync)(o,e),new y.Worker(o,{execArgv:[...r,...process.execArgv],workerData:s,env:process.env})}static async run(e,s){return new Promise((o,r)=>{let n=p.build(e,s),c=t=>{t!==0&&r(new Error(`Worker stopped with exit code ${t}`))};n.once("message",t=>{n.off("error",r),n.off("exit",c),o(t)}),n.once("error",r),n.once("exit",c)})}static async watch(e,s,o){return new Promise((r,n)=>{let c=p.build(e,s),t=f=>{f!==0?n(new Error(`Worker stopped with exit code ${f}`)):r(null)};c.on("message",o),c.once("error",n),c.once("exit",t)})}};var j=i("zlib"),R,C=()=>(typeof R>"u"&&(R=(0,j.brotliDecompressSync)(Buffer.from("G9cLAMTnbdM7l9N/mYVK6MRCxY0H6RxN6/P7vzeB10oFXsQl+3fm/retpPSib15ax1AjyPGohqkhxMZgtv5KQgU8Y5FqxAmckUlcA1Iw9oQ/S1D770/U7oKiwWmNVfy8Ce50RcNCICKw8/TX5iiLKHkmhcWv9nind7TNFK5utAL2LA9MYJ6O+Vs7V6887Ul/i0BqPjdbuNw/gpWT2TDkb6C5vRaVj0TrCkDX+ph0zMdZAerdfsen5t5SCX2gckX/G0UCb1V9V/xXABwMTB8AcogIJzLoH/+6DBMoW1OnmXCQf7O2OWHrY+Vi2hLeUtwmPe9HidE4D3T+p0zYO9bvraqFXn+Vr/QuLvL6aljori5xckmhiwRIjWxZfhlAtBNZ0RCq9SgNbgtbdPiuRU20EAFhVk5osqZlk32IelT3x2YyIKqKFER74MOCp7FI7ub6wvBj++JemlKR+zp/6fCXGhSZqgcH4nuBgr3LasCA9zYTSi7AG4sYMr5+bfgfuw3Acjv/5XOoJnHQ/ALk+J9fbQkpTFkXxk/whoMc6km1BXkEohZbdl5cNYVyhhQWwA/1MSgLYMXBIAebDseU9LcbQINQetnjYSZD0jBKDOaDFbsJCehQ89X4bVDkQG0fPYMxhij4QytG7l+NHPkzDjnHBv4pjmfiqO1IDTio6CQHaRMaUSRukU1/xQeUelY9fEZKrNAn+Kt5nstd+0cCRndWIbFGXTkVwcxzzQXGcEfRKzp4GIT8yTDEz+35QonVcPGIQub7RcoWJ6jp3ErwHfDGvp8X7FjZvwD08a36zUAo/u8/eR3jIASSpv4VRSVOj0OCKwBKa0hgtkjJ76c2ddG67LmxOy7dOP00PFCCBPYgkUiAQPokQUr6ZtaJanGO0yJlX1f04zaCadKCvVaRSPascSFdOCip0y5zm26cWPSNiqBBYNPvxpNgURlXMrkes2zvPzIO4xwB","base64")).toString()),R);var d=class{constructor(e){this.cwd=e}async run(e,s,o){return p.run(C(),{cwd:this.cwd,type:e,options:s,files:o})}};var l=class extends B.BaseCommand{constructor(){super(...arguments);this.bail=u.Option.Boolean("-b,--bail",!1);this.updateSnapshot=u.Option.Boolean("-u,--update-shapshot",!1);this.findRelatedTests=u.Option.Boolean("--find-related-tests",!1);this.files=u.Option.Rest({required:0})}async execute(){let s=await T.Configuration.find(this.context.cwd,this.context.plugins),{project:o,workspace:r}=await v.Project.find(s,this.context.cwd),n=[];if(r)if(this.files?.length>0){let t=this.context.cwd.replace(o.cwd,"");this.files.forEach(f=>n.push((0,S.join)(t.startsWith("/")?t.substr(1):t,f)))}else{let t=this.context.cwd.replace(o.cwd,"");n.push(t.startsWith("/")?t.substr(1):t)}else this.files?.length>0&&this.files.forEach(t=>n.push(t));return(await P.StreamReport.start({stdout:this.context.stdout,configuration:s},async()=>{await new d(o.cwd).run("integration",{findRelatedTests:this.findRelatedTests,updateSnapshot:this.updateSnapshot,bail:this.bail},n)})).exitCode()}};l.paths=[["test","integration"]];var Q=i("node:path"),X=i("@yarnpkg/cli"),O=i("@yarnpkg/core"),V=i("@yarnpkg/core"),W=i("@yarnpkg/core"),w=i("clipanion");var h=class extends X.BaseCommand{constructor(){super(...arguments);this.bail=w.Option.Boolean("-b,--bail",!1);this.updateSnapshot=w.Option.Boolean("-u,--update-shapshot",!1);this.findRelatedTests=w.Option.Boolean("--find-related-tests",!1);this.files=w.Option.Rest({required:0})}async execute(){let s=await V.Configuration.find(this.context.cwd,this.context.plugins),{project:o,workspace:r}=await W.Project.find(s,this.context.cwd),n=[];if(r)if(this.files?.length>0){let t=this.context.cwd.replace(o.cwd,"");this.files.forEach(f=>n.push((0,Q.join)(t.startsWith("/")?t.substr(1):t,f)))}else{let t=this.context.cwd.replace(o.cwd,"");n.push(t.startsWith("/")?t.substr(1):t)}else this.files?.length>0&&this.files.forEach(t=>n.push(t));return(await O.StreamReport.start({stdout:this.context.stdout,configuration:s},async()=>{await new d(o.cwd).run("unit",{findRelatedTests:this.findRelatedTests,updateSnapshot:this.updateSnapshot,bail:this.bail},n)})).exitCode()}};h.paths=[["test","unit"]];var z={commands:[l,h]};return F(G);})();
return plugin;
}
};
